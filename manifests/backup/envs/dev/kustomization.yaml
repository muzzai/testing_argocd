apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - ../../base
patches:
  # VictoriaMetrics backup → dev S3 bucket
  - target:
      kind: CronJob
      name: vmbackup
    patch: |-
      - op: replace
        path: /spec/jobTemplate/spec/template/spec/containers/0/args/1
        value: "-dst=s3://monitoring-backups-dev/vmbackup/"
  # VictoriaLogs backup → dev S3 bucket
  - target:
      kind: CronJob
      name: vlbackup
    patch: |-
      - op: replace
        path: /spec/jobTemplate/spec/template/spec/containers/0/args/1
        value: "-dst=s3://monitoring-backups-dev/vlbackup/"
  # Dev runs on k3s (self-managed k8s on EC2).
  # S3 access via IAM Instance Profile — no IRSA annotation needed.
